name: Android Scrcpy (Input Fix)

on: workflow_dispatch

jobs:
  build-core:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Initialize Environment
        run: |
          curl -fsSL https://tailscale.com/install.sh | sudo sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=rov-src --accept-routes

      - name: Mount Test Container
        run: |
          # Perbaikan: WEB_VNC=true agar input touch terdeteksi sistem
          docker run -d -p 5555:5555 -p 6080:6080 \
            -e EMULATOR_DEVICE="Samsung Galaxy S10" \
            -e WEB_VNC=true \
            --device /dev/kvm \
            --name build-container \
            --privileged \
            budtmo/docker-android:emulator_11.0

      - name: Run Integrity Check
        run: |
          timeout 300s bash -c 'until docker exec build-container adb wait-for-device; do sleep 5; done'

      - name: Await Completion Signal
        run: while true; do sleep 300; done